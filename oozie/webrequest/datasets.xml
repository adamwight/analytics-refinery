<?xml version="1.0" encoding="UTF-8"?>
<!--
Defines reusable datasets for raw webrequest data.
Use this dataset in your coordinator.xml files by setting:

    ${start_time}     - the initial instance of your data.
                        Example: 2014-04-01T00:00Z
    ${webrequest_data_directory} - Path to directory where data is time bucketed.
                        Example: /wmf/data/raw/webrequest
    ${webrequest_refined_data_directory} - Path to directory where refined data is time bucketed.
                        Example: /wmf/data/wmf/webrequest
-->

<datasets>
    <!--
    The webrequest_*_unchecked datasets should be used for cases where you do
    not care if the sequence stats have been checked.  This will simply include
    any imported hourly data directories that exist.
    -->
    <dataset name="webrequest_bits_unchecked"
             frequency="${coord:hours(1)}"
             initial-instance="${start_time}"
             timezone="Universal">
        <uri-template>${webrequest_data_directory}/webrequest_bits/hourly/${YEAR}/${MONTH}/${DAY}/${HOUR}</uri-template>
        <done-flag></done-flag>
    </dataset>
    <dataset name="webrequest_mobile_unchecked"
             frequency="${coord:hours(1)}"
             initial-instance="${start_time}"
             timezone="Universal">
        <uri-template>${webrequest_data_directory}/webrequest_mobile/hourly/${YEAR}/${MONTH}/${DAY}/${HOUR}</uri-template>
        <done-flag></done-flag>
    </dataset>
    <dataset name="webrequest_text_unchecked"
             frequency="${coord:hours(1)}"
             initial-instance="${start_time}"
             timezone="Universal">
        <uri-template>${webrequest_data_directory}/webrequest_text/hourly/${YEAR}/${MONTH}/${DAY}/${HOUR}</uri-template>
        <done-flag></done-flag>
    </dataset>
    <dataset name="webrequest_upload_unchecked"
             frequency="${coord:hours(1)}"
             initial-instance="${start_time}"
             timezone="Universal">
        <uri-template>${webrequest_data_directory}/webrequest_upload/hourly/${YEAR}/${MONTH}/${DAY}/${HOUR}</uri-template>
        <done-flag></done-flag>
    </dataset>

    <!--
    The webrequest_* datasets should be used if you want to be
    sure that you are only working with hourly imports for which
    sequence stats have been checked.  These directories have an
    empty _SUCCESS flag created in them once they have been checked
    and it has been determined that the expected number of requests
    equals the actual number of entires for this hour.
    -->
    <dataset name="webrequest_bits"
             frequency="${coord:hours(1)}"
             initial-instance="${start_time}"
             timezone="Universal">
        <uri-template>${webrequest_data_directory}/webrequest_bits/hourly/${YEAR}/${MONTH}/${DAY}/${HOUR}</uri-template>
        <done-flag>_SUCCESS</done-flag>
    </dataset>
    <dataset name="webrequest_mobile"
             frequency="${coord:hours(1)}"
             initial-instance="${start_time}"
             timezone="Universal">
        <uri-template>${webrequest_data_directory}/webrequest_mobile/hourly/${YEAR}/${MONTH}/${DAY}/${HOUR}</uri-template>
        <done-flag>_SUCCESS</done-flag>
    </dataset>
    <dataset name="webrequest_text"
             frequency="${coord:hours(1)}"
             initial-instance="${start_time}"
             timezone="Universal">
        <uri-template>${webrequest_data_directory}/webrequest_text/hourly/${YEAR}/${MONTH}/${DAY}/${HOUR}</uri-template>
        <done-flag>_SUCCESS</done-flag>
    </dataset>
    <dataset name="webrequest_upload"
             frequency="${coord:hours(1)}"
             initial-instance="${start_time}"
             timezone="Universal">
        <uri-template>${webrequest_data_directory}/webrequest_upload/hourly/${YEAR}/${MONTH}/${DAY}/${HOUR}</uri-template>
        <done-flag>_SUCCESS</done-flag>
    </dataset>

    <!--
    The webrequest_*_refined datasets contain the same data as the
    above two 'raw' datasets, except that they use a more efficient
    storage format, and contain extra information.

    This dataset does not yet include upload or bits.

    TODO: I would like to eventually name this data set 'webrequest_mobile',
          etc.  and rename the above dataset to webrequest_mobile_raw, etc.
    -->
    <dataset name="webrequest_mobile_refined"
             frequency="${coord:hours(1)}"
             initial-instance="${start_time}"
             timezone="Universal">
        <uri-template>${webrequest_refined_data_directory}/webrequest_source=mobile/year=${YEAR}/month=${MONTH}/day=${DAY}/hour=${HOUR}</uri-template>
    </dataset>
    <dataset name="webrequest_text_refined"
             frequency="${coord:hours(1)}"
             initial-instance="${start_time}"
             timezone="Universal">
        <uri-template>${webrequest_refined_data_directory}/webrequest_source=upload/year=${YEAR}/month=${MONTH}/day=${DAY}/hour=${HOUR}</uri-template>
    </dataset>

</datasets>
